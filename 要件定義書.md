# EC 在庫管理最適化ツール 要件定義書

## 1. プロジェクト概要

### 1.1 目的

EC 販売における在庫管理の最適化を目的とした Web アプリケーション。特に在庫切れ防止に重点を置き、各商品の在庫切れまでの週数を可視化することで、適切な発注タイミングを判断できるようにする。

### 1.2 対象ユーザー

- 在庫管理者
- 発注担当者
- 経営者

### 1.3 想定規模

- 商品数: 約 1,000 点（アクセサリー等）
- 在庫保管場所: 自社倉庫

## 2. 機能要件

### 2.1 認証機能

- **FR-001**: ユーザーログイン機能
  - メールアドレスとパスワードによる認証
  - セッション管理
  - ログアウト機能

### 2.2 商品管理機能

- **FR-002**: 商品マスタ管理
  - 商品の登録・編集・削除
  - 商品情報（商品名、SKU、カテゴリ、仕入価格、販売価格など）
  - 商品一覧表示（検索・フィルタ機能）
  - 最大 1,000 点の商品を扱える設計

### 2.3 在庫管理機能

- **FR-003**: 在庫数の管理
  - 現在在庫数の表示・更新
  - 在庫履歴の記録
  - 入荷・出荷の記録

### 2.4 在庫最適化機能（コア機能）

- **FR-004**: 在庫切れまでの週数算出

  - 直近 1 週間の販売実績をベースに週次平均販売数を算出
  - 現在在庫数 ÷ 週次平均販売数 = 在庫切れまでの週数
  - 各商品ごとに週数を表示
  - 販売実績がない新商品については、予測値（週次予測販売数）を設定可能
  - 予測値が設定されている場合は、予測値 ÷ 現在在庫数で週数を算出

- **FR-005**: 在庫アラート機能

  - 在庫切れまでの週数が 2 週を切った時点でアラートを発動
  - アラート商品の一覧表示
  - 通知方法：
    - 画面表示（ダッシュボード、商品一覧）
    - メール通知
    - LINE 連携（Webhook 経由）
    - Slack 連携（Webhook 経由）
  - 通知先の設定機能

- **FR-006**: 発注推奨機能
  - 在庫切れまでの週数に基づいた発注タイミングの提示
  - 発注が必要な商品の一覧表示

### 2.5 Shopify 連携機能

- **FR-007**: Shopify API 連携
  - Shopify ストアとの在庫同期（リアルタイム更新を目指す）
  - 在庫数の同期方向：片方向（Shopify → システム）
  - Shopify の在庫数を取得してシステムに反映
  - 在庫数の入力・更新は Shopify 側で行う
  - API 認証情報の設定機能（ユーザーが設定画面で入力）

### 2.6 販売実績管理機能

- **FR-008**: 販売履歴の記録
  - Shopify からの販売データ取得
  - 週次・月次での販売実績の集計
  - 販売トレンドの可視化

### 2.7 発注管理機能

- **FR-009**: 発注履歴管理

  - 発注履歴の記録（発注日、商品、数量、発注先など）
  - 発注履歴の一覧表示・検索
  - 発注ステータス管理（発注済み、入荷済みなど）

- **FR-010**: 発注先（サプライヤー）管理
  - 発注先の登録・編集・削除
  - 発注先情報（名称、連絡先、メールアドレスなど）
  - 商品と発注先の紐付け

### 2.8 ダッシュボード機能

- **FR-011**: 在庫状況の一覧表示
  - 在庫切れまでの週数が少ない商品の優先表示
  - アラート商品の件数表示
  - 在庫状況のサマリー表示

## 3. 非機能要件

### 3.1 パフォーマンス要件

- **NFR-001**: 1,000 点の商品データを扱える設計
- **NFR-002**: 在庫数の更新はリアルタイムに近い形で反映（目標：1 分以内）

### 3.2 セキュリティ要件

- **NFR-003**: ログイン情報の暗号化
- **NFR-004**: Shopify API 認証情報の安全な保存

### 3.3 可用性要件

- **NFR-005**: Web ブラウザからアクセス可能
- **NFR-006**: レスポンシブデザイン（PC・タブレット対応）

## 4. 技術要件

### 4.1 アーキテクチャ

- Web アプリケーション
- フレームワーク: Next.js（App Router 推奨）
  - フロントエンド: React + TypeScript
  - バックエンド: Next.js API Routes / Server Actions
- データベース: PostgreSQL（推奨）
  - ORM: Prisma または Drizzle ORM
- 認証: NextAuth.js（Auth.js）
- UI ライブラリ: Tailwind CSS + shadcn/ui（推奨）または Material-UI
- 状態管理: React Context API または Zustand

### 4.2 外部連携

- Shopify Admin API
  - 認証方式: Private App または Custom App（OAuth）
  - 在庫データの取得（Products API, Inventory API）
  - 販売データの取得（Orders API）
- 通知連携
  - メール: SMTP または SendGrid などのメールサービス
  - LINE: LINE Notify API（Webhook）
  - Slack: Slack Incoming Webhooks

## 5. 画面構成（案）

1. **ログイン画面**
2. **ダッシュボード**
   - 在庫アラート一覧
   - 在庫状況サマリー
3. **商品一覧画面**
   - 在庫切れまでの週数表示
   - 検索・フィルタ機能
4. **商品詳細画面**
   - 商品情報
   - 在庫履歴
   - 販売実績グラフ
5. **在庫管理画面**
   - 入荷・出荷の記録
6. **発注管理画面**
   - 発注履歴一覧
   - 発注先一覧・管理
   - 発注登録
7. **設定画面**
   - Shopify 連携設定
   - アラート基準値設定
   - 通知先設定（メール、LINE、Slack）

## 6. データモデル（案）

### 6.1 主要エンティティ

- **User（ユーザー）**: ログイン情報
- **Product（商品）**: 商品マスタ情報
  - 商品名、SKU、カテゴリ、仕入価格、販売価格
  - 週次予測販売数（新商品用）
  - 発注先 ID（外部キー）
- **Inventory（在庫）**: 現在在庫数
  - 商品 ID（外部キー）
  - 現在在庫数
  - 最終更新日時
- **SalesHistory（販売履歴）**: 販売実績データ
  - 商品 ID（外部キー）
  - 販売日時
  - 販売数量
- **InventoryHistory（在庫履歴）**: 在庫数の変動履歴
  - 商品 ID（外部キー）
  - 変動日時
  - 変動前在庫数
  - 変動後在庫数
  - 変動種別（入荷、出荷、調整など）
- **Supplier（発注先）**: サプライヤー情報
  - 発注先名、連絡先、メールアドレス
- **PurchaseOrder（発注）**: 発注履歴
  - 発注先 ID（外部キー）
  - 商品 ID（外部キー）
  - 発注日
  - 発注数量
  - 発注ステータス
  - 入荷予定日
- **AlertSetting（アラート設定）**: アラート基準値
  - アラート基準週数（デフォルト: 2 週）
  - 通知方法設定

## 7. 詳細仕様

### 7.1 在庫切れまでの週数算出ロジック

- **既存商品の場合**:

  - 直近 1 週間（7 日間）の販売実績から週次平均販売数を算出
  - 週次平均販売数 = 直近 1 週間の総販売数 ÷ 7 日 × 7 日 = 直近 1 週間の総販売数
  - 在庫切れまでの週数 = 現在在庫数 ÷ 週次平均販売数
  - 販売実績がない場合は、予測値を使用

- **新商品の場合**:
  - ユーザーが設定した週次予測販売数を使用
  - 在庫切れまでの週数 = 現在在庫数 ÷ 週次予測販売数
  - 販売実績が蓄積されたら、実績ベースの算出に自動切り替え

### 7.2 アラート機能詳細

- **アラート基準**: 在庫切れまでの週数 < 2 週
- **通知タイミング**:
  - リアルタイム: 在庫数更新時にチェック
  - 定期チェック: 1 日 1 回（朝の定時チェック推奨）
- **通知先設定**: 複数の通知先を設定可能

### 7.3 Shopify 連携詳細

- **同期方向**: 片方向（Shopify → システム）
- **同期頻度**: リアルタイム（Webhook）または定期ポーリング（1 分間隔）
- **取得データ**:
  - 商品情報（商品名、SKU、価格など）
  - 在庫数
  - 販売履歴（注文データ）

## 8. 今後の検討事項

- [ ] データ保存期間（販売履歴、在庫履歴の保持期間）
- [ ] データベースの選定（PostgreSQL 推奨）
- [ ] ホスティング環境（Vercel、AWS、その他）
- [ ] Shopify API 認証方式の詳細（Private App vs Custom App）
- [ ] 通知サービスの選定（メール送信サービス）

## 9. 開発フェーズ（案）

### Phase 1: 基本機能

- 認証機能（ログイン・ログアウト）
- 商品管理機能（CRUD）
- 在庫管理機能（在庫数の表示・更新）
- データベース設計・構築

### Phase 2: 最適化機能

- 在庫切れまでの週数算出ロジック実装
- 新商品の予測値設定機能
- 在庫アラート機能（画面表示）
- ダッシュボード実装

### Phase 3: 外部連携

- Shopify API 連携（在庫数取得）
- Shopify API 連携（販売履歴取得）
- 自動同期機能

### Phase 4: 発注管理機能

- 発注先（サプライヤー）管理
- 発注履歴管理
- 発注登録機能

### Phase 5: 通知機能

- メール通知機能
- LINE 連携（Webhook）
- Slack 連携（Webhook）
- 通知設定画面

### Phase 6: 拡張機能・最適化

- パフォーマンス最適化
- UI/UX 改善
- レポート機能（オプション）
